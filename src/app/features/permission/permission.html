<div class="permission-container">
    <p-toast></p-toast>

    <p-card>
        <ng-template pTemplate="header">
            <div class="flex justify-between items-center p-4">
                <h2 class="text-xl font-semibold m-0">Permission Management</h2>
                <p-button label="Create Permission" icon="pi pi-plus" (click)="openCreateDialog()"
                    severity="success"></p-button>
            </div>
        </ng-template>

        <p-table [value]="permissions()" [loading]="loading()" [paginator]="true" [rows]="10"
            [rowsPerPageOptions]="[5, 10, 20, 50]" [globalFilterFields]="['code']" class="p-datatable-sm"
            [tableStyle]="{ 'min-width': '50rem' }">

            <ng-template pTemplate="caption">
                <div class="flex justify-between items-center">
                    <span class="p-input-icon-left w-full md:w-auto">
                        <i class="pi pi-search me-3"></i>
                        <input pInputText type="text" placeholder="Search permissions..." class="w-full md:w-80" />
                    </span>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="code" style="width: 100%">
                        Permission Code <p-sortIcon field="code"></p-sortIcon>
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-permission>
                <tr>
                    <td>
                        <div class="flex items-center gap-2">
                            <i class="pi pi-key text-primary-600"></i>
                            <span class="font-mono font-medium">{{ permission.code }}</span>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="1" class="text-center py-8">
                        <i class="pi pi-lock text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">No permissions found</p>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>

    <!-- Create Dialog -->
    <p-dialog header="Create Permission" [(visible)]="dialogVisible" [modal]="true" [style]="{ width: '450px' }"
        [draggable]="false" [resizable]="false">
        <div class="flex flex-col gap-4 py-4">
            <div class="flex flex-col gap-2">
                <label for="permissionCode" class="font-semibold">Permission Code</label>
                <input pInputText id="permissionCode" [value]="permissionForm().code"
                    (input)="updateFormField('code', $any($event.target).value)"
                    placeholder="e.g., VIEW_USER, EDIT_ROLE" class="w-full font-mono" />
                <small class="text-gray-500">Use uppercase with underscores (e.g., CREATE_USER, DELETE_ROLE)</small>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <p-button label="Cancel" severity="secondary" (click)="closeDialog()" [text]="true"></p-button>
            <p-button label="Create" (click)="savePermission()" [loading]="loading()"></p-button>
        </ng-template>
    </p-dialog>
</div>