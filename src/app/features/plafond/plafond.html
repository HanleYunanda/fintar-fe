<div class="plafond-container">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <p-card>
        <ng-template pTemplate="header">
            <div class="flex justify-between items-center p-4">
                <h2 class="text-xl font-semibold m-0 text-blue-800">Plafond Management</h2>
                <p-button label="Add Plafond" icon="pi pi-plus" (click)="openCreateDialog()"
                    severity="success"></p-button>
            </div>
        </ng-template>

        <p-table [value]="plafonds()" [loading]="loading()" [paginator]="true" [rows]="10"
            [rowsPerPageOptions]="[5, 10, 20]" [globalFilterFields]="['name']" class="p-datatable-sm"
            [tableStyle]="{ 'min-width': '50rem' }">

            <ng-template pTemplate="caption">
                <div class="flex justify-between items-center">
                    <span class="p-input-icon-left w-full md:w-auto">
                        <i class="pi pi-search me-3"></i>
                        <input pInputText type="text" placeholder="Search plafond..." class="w-full md:w-80"
                            #searchInput (input)="searchValue.set(searchInput.value)" />
                    </span>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
                    <th pSortableColumn="maxAmount" class="text-right">Max Amount <p-sortIcon
                            field="maxAmount"></p-sortIcon></th>
                    <th pSortableColumn="maxTenor" class="text-right">Max Tenor <p-sortIcon
                            field="maxTenor"></p-sortIcon></th>
                    <th class="text-center">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-plafond>
                <tr>
                    <td><span class="font-medium text-gray-700">{{ plafond.name }}</span></td>
                    <td class="text-right font-semibold text-blue-600">
                        {{ plafond.maxAmount | currency:'IDR':'symbol':'1.0-0' }}
                    </td>
                    <td class="text-right text-gray-600">
                        {{ plafond.maxTenor }} months
                    </td>
                    <td>
                        <div class="flex justify-center gap-2">
                            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="warn"
                                (click)="openEditDialog(plafond)" pTooltip="Edit" tooltipPosition="top"></p-button>
                            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                                (click)="deletePlafond(plafond)" pTooltip="Delete" tooltipPosition="top"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4" class="text-center py-8">
                        <i class="pi pi-money-bill text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">No plafond found</p>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-card>

    <!-- Create/Edit Dialog -->
    <p-dialog [header]="dialogMode() === 'create' ? 'Add New Plafond' : 'Edit Plafond'" [(visible)]="dialogVisible"
        [modal]="true" [style]="{ width: '450px' }" [draggable]="false" [resizable]="false">

        <div class="flex flex-col gap-5 py-4">
            <!-- Name -->
            <div class="flex flex-col gap-2">
                <label for="name" class="font-semibold text-gray-700">Plafond Name <span
                        class="text-red-500">*</span></label>
                <input pInputText id="name" [value]="plafondForm().name"
                    (input)="updateFormField('name', $any($event.target).value)" placeholder="e.g., Personal Loan Gold"
                    class="w-full" />
            </div>

            <!-- Max Amount -->
            <div class="flex flex-col gap-2">
                <label for="maxAmount" class="font-semibold text-gray-700">Maximum Amount (IDR) <span
                        class="text-red-500">*</span></label>
                <p-inputNumber id="maxAmount" [(ngModel)]="plafondForm().maxAmount" mode="currency" currency="IDR"
                    locale="id-ID" placeholder="Enter maximum amount" class="w-full" [min]="0">
                </p-inputNumber>
            </div>

            <!-- Max Tenor -->
            <div class="flex flex-col gap-2">
                <label for="maxTenor" class="font-semibold text-gray-700">Maximum Tenor (Months) <span
                        class="text-red-500">*</span></label>
                <p-inputNumber id="maxTenor" [(ngModel)]="plafondForm().maxTenor" placeholder="Enter maximum months"
                    class="w-full" [min]="1" suffix=" months">
                </p-inputNumber>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <p-button label="Cancel" severity="secondary" (click)="closeDialog()" [text]="true"></p-button>
            <p-button [label]="dialogMode() === 'create' ? 'Save' : 'Update'" (click)="savePlafond()" severity="success"
                [loading]="loading()"></p-button>
        </ng-template>
    </p-dialog>
</div>