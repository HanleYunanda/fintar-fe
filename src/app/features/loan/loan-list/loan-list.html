<div class="card">
    <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-800">Loan Applications</h1>
        <p-button icon="pi pi-refresh" (click)="loadLoans()" [loading]="loading()" severity="secondary"
            [text]="true"></p-button>
    </div>

    <!-- Filters -->
    <div
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 rounded-lg border border-gray-100">
        <div class="flex flex-col gap-2">
            <label class="text-xs font-semibold text-gray-500 uppercase">Loan ID</label>
            <p-iconfield iconPosition="left">
                <p-inputicon styleClass="pi pi-id-card"></p-inputicon>
                <input type="text" pInputText placeholder="Search Loan ID..." [ngModel]="filterLoanId()"
                    (ngModelChange)="filterLoanId.set($event)" class="w-full" />
            </p-iconfield>
        </div>

        <div class="flex flex-col gap-2">
            <label class="text-xs font-semibold text-gray-500 uppercase">Status</label>
            <p-select [options]="statusOptions" [ngModel]="filterStatus()" (ngModelChange)="filterStatus.set($event)"
                placeholder="Select Status" styleClass="w-full" optionLabel="label" optionValue="value"
                appendTo="body"></p-select>
        </div>

        <div class="flex flex-col gap-2">
            <label class="text-xs font-semibold text-gray-500 uppercase">Start Date</label>
            <p-datepicker [ngModel]="filterStartDate()" (ngModelChange)="filterStartDate.set($event)"
                placeholder="Start Date" dateFormat="dd/mm/yy" [showIcon]="true" styleClass="w-full"></p-datepicker>
        </div>

        <div class="flex flex-col gap-2">
            <label class="text-xs font-semibold text-gray-500 uppercase">End Date</label>
            <p-datepicker [ngModel]="filterEndDate()" (ngModelChange)="filterEndDate.set($event)" placeholder="End Date"
                dateFormat="dd/mm/yy" [showIcon]="true" styleClass="w-full"></p-datepicker>
        </div>

        <div class="flex items-end">
            <p-button label="Clear Filters" icon="pi pi-filter-slash" (click)="clearFilters()" [outlined]="true"
                severity="secondary" styleClass="w-full"
                [disabled]="!filterLoanId() && !filterStatus() && !filterStartDate() && !filterEndDate()"></p-button>
        </div>
    </div>

    <p-table [value]="loans()" [loading]="loading()" [paginator]="true" [rows]="10" removableSort
        responsiveLayout="scroll">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="loanId">Loan ID <p-sortIcon field="loanId"></p-sortIcon></th>
                <th pSortableColumn="product.plafond.name">Product <p-sortIcon
                        field="product.plafond.name"></p-sortIcon></th>
                <th pSortableColumn="principalDebt">Principal <p-sortIcon field="principalDebt"></p-sortIcon></th>
                <th pSortableColumn="outstandingDebt">Outstanding <p-sortIcon field="outstandingDebt"></p-sortIcon></th>
                <th pSortableColumn="tenor">Tenor <p-sortIcon field="tenor"></p-sortIcon></th>
                <th pSortableColumn="createdAt">Submission Date <p-sortIcon field="createdAt"></p-sortIcon>
                </th>
                <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon></th>
                <th>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-loan>
            <tr>
                <td>{{ loan.id || '-' }}</td>
                <td>{{ loan.product?.plafond?.name || '-' }}</td>
                <td>{{ loan.principalDebt | currency:'IDR':'symbol':'1.0-0' }}</td>
                <td>{{ loan.outstandingDebt | currency:'IDR':'symbol':'1.0-0' }}</td>
                <td>{{ loan.tenor }} Months</td>
                <td>{{ loan.createdAt | date:'dd MMMM yyyy'}}</td>
                <td>
                    <p-tag [value]="loan.status" [severity]="getSeverity(loan.status)"></p-tag>
                </td>
                <td>
                    <div class="flex gap-2">
                        <p-button icon="pi pi-eye" [text]="true" severity="info" (click)="viewDetail(loan)"
                            pTooltip="View Detail"></p-button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7" class="text-center p-4">No loan applications found.</td>
            </tr>
        </ng-template>
    </p-table>
</div>